Update flag is not implmented, Unexpected termination of the program will result in some differences. CompactFile() should fix all the problems. //TODO implment self-check.
